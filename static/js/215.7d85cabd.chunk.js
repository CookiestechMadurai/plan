"use strict";(self.webpackChunkplan=self.webpackChunkplan||[]).push([[215],{215:(e,t,d)=>{d.r(t),d.d(t,{default:()=>f});var s=d(43),r=d(216),a=d(472),n=d(791),o=d(729),i=d(999),l=d(579);const c={pageWrapper:{backgroundColor:"#003f66",minHeight:"100vh",padding:"20px"},container:{display:"flex",height:"calc(100vh - 40px)",borderRadius:"12px",overflow:"hidden",boxShadow:"0 4px 12px rgba(0,0,0,0.1)",backgroundColor:"#ffffff",marginTop:"60px"},sidebar:{width:"30%",borderRight:"1px solid #ddd",backgroundColor:"#f9f9f9",overflowY:"auto"},sidebarHeader:{margin:0,padding:"16px",borderBottom:"1px solid #ddd",fontSize:"18px",backgroundColor:"#e6f7ff",color:"#003f66"},contact:{padding:"12px 16px",cursor:"pointer",borderBottom:"1px solid #eee",color:"#003f66"},chatbox:{width:"70%",display:"flex",flexDirection:"column",backgroundColor:"#fafafa"},chatHeader:{padding:"16px",backgroundColor:"#e6f7ff",borderBottom:"1px solid #ddd",color:"#003f66",fontWeight:"600"},chatBody:{flex:1,padding:"16px",overflowY:"auto",display:"flex",flexDirection:"column",gap:"12px"},messageBubble:{maxWidth:"60%",padding:"12px",borderRadius:"12px",boxShadow:"0 1px 2px rgba(0,0,0,0.1)"},messageText:{margin:0,color:"#333"},messageMeta:{display:"flex",justifyContent:"flex-end",alignItems:"center",gap:"8px",marginTop:"6px",fontSize:"12px",color:"#555"},metaName:{fontWeight:"500"},metaTime:{},metaStatus:{fontSize:"14px"},chatInput:{display:"flex",borderTop:"1px solid #ddd",padding:"12px",backgroundColor:"#fff"},input:{flex:1,padding:"10px 14px",borderRadius:"20px",border:"1px solid #ccc",outline:"none",marginRight:"12px"},sendBtn:{padding:"10px 18px",backgroundColor:"#25D366",color:"#fff",border:"none",borderRadius:"20px",cursor:"pointer"},noChat:{flex:1,display:"flex",justifyContent:"center",alignItems:"center",color:"#777",fontSize:"16px"}},f=()=>{const[e,t]=(0,s.useState)([]),[d,f]=(0,s.useState)(null),[p,u]=(0,s.useState)([]),[x,h]=(0,s.useState)(""),[m,g]=(0,s.useState)(""),b=(0,o.xI)().currentUser,y=(0,s.useRef)(null),v=(0,r.zy)();(0,s.useEffect)((()=>{const e=new URLSearchParams(v.search),t=e.get("vendorId"),d=e.get("vendorName");t&&d&&f({senderId:t,senderName:d})}),[v.search]),(0,s.useEffect)((()=>{(async()=>{if(!b)return;const e=(0,a.H9)(n.db,"user",b.uid),t=await(0,a.x7)(e);if(t.exists()){const e=t.data();g(e.fullName||"")}})()}),[b]),(0,s.useEffect)((()=>{var e;null===(e=y.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})}),[p]),(0,s.useEffect)((()=>{if(!b)return;return(0,a.aQ)((0,a.P)((0,a.rJ)(n.db,"webchat"),(0,a._M)("receiverId","==",b.uid)),(e=>{const d=e.docs.map((e=>e.data())),s=Array.from(new Map(d.map((e=>[e.senderId,e]))).values());t(s)}))}),[b]),(0,s.useEffect)((()=>{if(!d||!b)return;const e=(0,a.P)((0,a.rJ)(n.db,"webchat"),(0,a._M)("senderId","in",[b.uid,d.senderId]),(0,a._M)("receiverId","in",[b.uid,d.senderId]),(0,a.My)("time"),(0,a.AB)(50));return(0,a.aQ)(e,(e=>{const t=e.docs.map((e=>({id:e.id,...e.data()})));u(t),e.docs.forEach((async e=>{const t=e.data();t.receiverId===b.uid&&"seen"!==t.status&&await(0,a.mZ)((0,a.H9)(n.db,"webchat",e.id),{status:"seen"})}))}))}),[d,b]);const j=(0,s.useCallback)((async()=>{x.trim()&&b&&d&&(await(0,a.gS)((0,a.rJ)(n.db,"webchat"),{senderId:b.uid,receiverId:d.senderId,senderName:m||"Anonymous",receiverName:d.senderName,message:x.trim(),time:(0,a.O5)(),status:"sent"}),h(""))}),[x,b,d,m]);return(0,l.jsxs)("div",{style:c.pageWrapper,children:[(0,l.jsx)(i.A,{}),(0,l.jsxs)("div",{style:c.container,children:[(0,l.jsxs)("div",{style:c.sidebar,children:[(0,l.jsx)("h3",{style:c.sidebarHeader,children:"Chats"}),e.map((e=>(0,l.jsx)("div",{style:{...c.contact,backgroundColor:(null===d||void 0===d?void 0:d.senderId)===e.senderId?"#e6f7ff":"#ffffff"},onClick:()=>f(e),children:e.senderName},e.senderId)))]}),(0,l.jsx)("div",{style:c.chatbox,children:d?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{style:c.chatHeader,children:["Chat with ",(0,l.jsx)("strong",{children:d.senderName})]}),(0,l.jsxs)("div",{style:c.chatBody,children:[p.map((e=>{const t=e.senderId===b.uid;return(0,l.jsxs)("div",{style:{...c.messageBubble,alignSelf:t?"flex-end":"flex-start",backgroundColor:t?"#dcf8c6":"#ffffff"},children:[(0,l.jsx)("p",{style:c.messageText,children:e.message}),(0,l.jsxs)("div",{style:c.messageMeta,children:[(0,l.jsx)("span",{style:c.metaName,children:e.senderName}),(0,l.jsx)("span",{style:c.metaTime,children:(d=e.time,null===d||void 0===d?void 0:d.toDate().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}))}),t&&(0,l.jsxs)("span",{style:c.metaStatus,children:["sent"===e.status&&"\u2713","delivered"===e.status&&"\u2713\u2713","seen"===e.status&&(0,l.jsx)("span",{style:{color:"#34B7F1"},children:"\u2713\u2713"})]})]})]},e.id);var d})),(0,l.jsx)("div",{ref:y})]}),(0,l.jsxs)("div",{style:c.chatInput,children:[(0,l.jsx)("input",{style:c.input,placeholder:"Type a message...",value:x,onChange:e=>h(e.target.value),onKeyDown:e=>"Enter"===e.key&&j()}),(0,l.jsx)("button",{style:c.sendBtn,onClick:j,children:"Send"})]})]}):(0,l.jsx)("div",{style:c.noChat,children:"Select a user to start chatting"})})]})]})}}}]);
//# sourceMappingURL=215.7d85cabd.chunk.js.map